<!DOCTYPE html>
<html lang="en">
<head>
    <!--DEV-ONLY-NOT-LOADED-DURING-RUNTIME-->
    <link href="../common/style/bootstrap.css" rel="stylesheet">
    <link href="../common/style/style.css" rel="stylesheet">
    <!--[onshow;block=head;when [visible.foo] == bar;comm]-->
    <!--DEV-ONLY-NOT-LOADED-DURING-RUNTIME-->
</head>

<!--HEAD - ONLOAD-->
<!--[onload;file=../common/common.head.html;getbody;comm]-->
<!--HEAD - ONLOAD-->

<body class="pmsClient">
<!--JS SECTION - ONLOAD-->
<!--[onload;file=../common/common.javascript.html;getbody;comm]-->
<!--JS SECTION - ONLOAD-->
<!--DEBUG SECTION - ONLOAD-->
<!--[onload;file=../common/include.debug.html;getbody;comm]-->
<!--DEBUG SECTION - ONLOAD-->
<!--HEADER SECTION - ONLOAD-->

<!--[onload;file=common.header.html;getbody;comm]-->
<!--HEADER SECTION - ONLOAD-->
<!-- Main content starts -->

<div class="content">
    <div class="mainbar">

        <!----------------------COMMON PAGE HEADING--------------------------------->
        <!--[onload;file=common.headbar.html;getbody;comm]-->
        <!----------------------COMMON PAGE HEADING--------------------------------->

        <div class="matter">
            <!----------------------COMMON PROJECT HEAD--------------------------------->
            <!--[onload;file=common.project.header.html;getbody;comm]-->
            <!----------------------COMMON PROJECT HEAD--------------------------------->
            <div class="container">
                <div class="row">
                    <!--WI_PROJECT_NAV_CONTENT-->
                    <div class="col-lg-2">
                        <!----------------------COMMON PROJECT MENU--------------------------------->
                        <!--[onload;file=common.project.navigation.html;getbody;comm]-->
                        <!----------------------COMMON PROJECT MENU--------------------------------->
                    </div>

                    <!--WI_PROJECT_NAV_CONTENT-->

                    <div class="col-lg-10">
                        <div class="widget">
                            <div class="widget-content widget-content-project">

                                <!-----------------------------------------------TABS-MILESTONES------------------------------------------------------------------>
                                <div class="project-info-tabs">
                                    <!--[onshow;block=div;when [visible.wi_project_milestones] == 1;comm]-->
                                    <!--WI_MILESTONES_NAVIGATION-->

                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="tabs-sub-nav"> 
                                                <div class="pull-left"><h3>Project Tasks</h3></div>
                                                <a data-toggle="modal" class="btn btn-mid btn-info pull-right" href="#addNewTaskModal"><i class="icon-plus"></i> [lang.lang_add_new_task]</a>
                                                <div class="clearfix"></div>
                                            </div>
                                        </div>

                                    </div>

                                    <!--WI_MILESTONES_NAVIGATION-->

                                    <!--WI_MILESTONES_TABLE-->
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <!--[onshow;block=div;when [visible.wi_milestones_table] == 1;comm]-->

                                            <div class="widget wtabs">
                                                <div class="widget-content">
                                                    <script type="text/javascript">
                                                        var row = 0;
                                                    </script>
                                                    <style type="text/css">
                                                        .even_row {
                                                            background: #FFFFE0;
                                                        }
                                                    </style>
                                                    <div class="table-responsive">
                                                        <table class="table table-bordered table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th>
                                                                    <!--<a href="[vars.sortby_companyname;noerr]">-->[lang.lang_title]<i class="icon-sort bns-padded-left"></i>
                                                                    <!--</a>-->
                                                                </th>
                                                                <th>Milestone</th>
                                                                <th>Billing Category</th>
                                                                <th>Assigned Developer</th>
                                                                <th>Assigned Hrs</th>
                                                                <th>Cost</th>
                                                                <th>Worked Hrs</th>
                                                                <th>Stage</th>
                                                                <th>Status</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>

                                                            <tr id="task-row[tasks.tasks_id]">
                                                                <td>
                                                                    <a href="[conf.site_url]/client/tasksexpanded/[tasks.tasks_project_id]/[tasks.tasks_id]">
                                                                        <!--[tasks.tasks_text;block=tr;comm;ope=max:100]-->
                                                                    </a><span style="color:red;"> [tasks.memo] </span>
                                                                </td>

                                                                <td>
                                                                    <!--[tasks.tasks_milestone_text;block=tr;comm;ope=max:100]-->
                                                                </td>
                                                                
                                                                <td>
                                                                    <script>
                                                                        $(document).ready(function() {
                                                                            var b_[tasks.tasks_id] = [tasks.billingcategory];
                                                                            if (b_[tasks.tasks_id] == 0) {
                                                                                $('#billingcategory_[tasks.tasks_id]').text('Preliminary Research and Discovery Phase');
                                                                                $('#billingcategory_[tasks.tasks_id]').addClass('label-success');
                                                                            } else if (b_[tasks.tasks_id] == 1) {
                                                                                $('#billingcategory_[tasks.tasks_id]').text('Strategic Planning');
                                                                                $('#billingcategory_[tasks.tasks_id]').addClass('label-success');
                                                                            } else if (b_[tasks.tasks_id] == 2) {
                                                                                $('#billingcategory_[tasks.tasks_id]').text('Web Design - Graphic Design Work');
                                                                                $('#billingcategory_[tasks.tasks_id]').addClass('label-warning');
                                                                            } else if (b_[tasks.tasks_id] == 3) {
                                                                                $('#billingcategory_[tasks.tasks_id]').text('Front End Programming');
                                                                                $('#billingcategory_[tasks.tasks_id]').addClass('label-purple');
                                                                            } else if (b_[tasks.tasks_id] == 4) {
                                                                                $('#billingcategory_[tasks.tasks_id]').text('Server-side Development');
                                                                                $('#billingcategory_[tasks.tasks_id]').addClass('label-purple');
                                                                            } else if ([tasks.billingcategory] == 5) {
                                                                                $('#billingcategory_[tasks.tasks_id]').text('Quality Assurance and Launch');
                                                                                $('#billingcategory_[tasks.tasks_id]').addClass('label-primary');
                                                                            } else if (b_[tasks.tasks_id] == 6) {
                                                                                $('#billingcategory_[tasks.tasks_id]').text('SEO, Promotion, Statisitics, and Reporting');
                                                                                $('#billingcategory_[tasks.tasks_id]').addClass('label-purple');
                                                                            } else {
                                                                                $('#billingcategory_[tasks.tasks_id]').text('N/A');
                                                                                $('#billingcategory_[tasks.tasks_id]').addClass('label-default');
                                                                            }
                                                                        });

                                                                        row = row + 1;
                                                                        if ((row % 2) == 0) {
                                                                            $('#task-row[tasks.tasks_id]').addClass('even_row');
                                                                        } else {
                                                                            $('#task-row[tasks.tasks_id]').addClass('odd_row');
                                                                        }
                                                                    </script>
                                                                    <span id="billingcategory_[tasks.tasks_id]" class="label"></span>
                                                                </td>
                                                                
                                                                <td>   
                                                                    <script>
                                                                        $(document).ready(function() {
                                                                            $.ajax({
                                                                                url: "[conf.site_url]/__freshbooksapi/getphoto.php?assignedTo=[tasks.tasks_assigned_to_id]&text"
                                                                            }).done(function(data) {
                                                                                $("#name_[tasks.tasks_id]").text(data);
                                                                            });
                                                                        });
                                                                    </script>
                                                                    <img src="[conf.site_url]/__freshbooksapi/getphoto.php?assignedTo=[tasks.tasks_assigned_to_id]" style="width:50px; height:50px;" />
                                                                    <p id="name_[tasks.tasks_id]"></p>     
                                                                </td>
                                                                <td>
                                                                    <!--[tasks.estimatedhours;block=tr;comm;ope=max:100]-->
                                                                </td>
                                                                <td>
                                                                    <span id="billing[tasks.tasks_id]">
                                                                    <script type="text/javascript">
                                                                          var billingcategory = [tasks.billingcategory];
                                                                          var costperhour = 0;
                                                                          switch(billingcategory) {
                                                                                      case 1:
                                                                                          costperhour = 75;
                                                                                          break;
                                                                                      case 2:
                                                                                          costperhour = 75;
                                                                                          break; 
                                                                                      case 3:
                                                                                          costperhour = 95;
                                                                                          break;
                                                                                      case 4:
                                                                                          costperhour = 125;
                                                                                          break;
                                                                                      case 5:
                                                                                          costperhour = 125;
                                                                                          break;  
                                                                                      case 6:
                                                                                          costperhour = 65;
                                                                                          break;
                                                                                      case 7:
                                                                                          costperhour = 125;
                                                                                          break;

                                                                                      default:
                                                                                           costperhour = 0;
                                                                                  }
                                                                                //$('#billing[tasks.tasks_id]').text('$'+[tasks.estimatedhours]*costperhour); 
                                                                                $('#billing[tasks.tasks_id]').text('$'+[tasks.hourslogged]*costperhour); 

                                                                        </script>
                                                                    </span>

                                                                </td>

                                                                <td>
                                                                    <!--[tasks.hourslogged;block=tr;comm;ope=max:100]-->
                                                                </td>
                                                                <td><span id="[tasks.tasks_id]"><script>
                                                                      var status = [tasks.accepted]; 
                                                                      $(document).ready(function(){
                                                                        $(".form_[tasks.tasks_id]").hide(); 
                                                                        $(".na_[tasks.tasks_id]").hide(); 
                                                                      $(".ap_[tasks.tasks_id]").hide(); 
                                                                      $(".ad_[tasks.tasks_id]").hide(); 
                                                                      });

                                                                      if (status == 0){ 
                                                                        $('#[tasks.tasks_id]').text('Assigned'); 
                                                                          $('#[tasks.tasks_id]').addClass('label label-default');
                                                                        $(document).ready(function(){
                                                                          $(".na_[tasks.tasks_id]").show(); 
                                                                        });
                                                                      }else if (status == 1){ 
                                                                        $('#[tasks.tasks_id]').text('In Progress'); 
                                                                          $('#[tasks.tasks_id]').addClass('label label-primary');
                                                                        $(document).ready(function(){
                                                                          $(".na_[tasks.tasks_id]").show(); 
                                                                        });
                                                                      }else if (status == 2){ 
                                                                        $('#[tasks.tasks_id]').text('Pending Client Approval'); 
                                                                            $('#[tasks.tasks_id]').addClass('label label-danger');
                                                                        $(document).ready(function(){
                                                                          $(".form_[tasks.tasks_id]").show(); 
                                                                        });
                                                                      }else if (status == 4){ 
                                                                        $('#[tasks.tasks_id]').text('Done'); 
                                                                          $('#[tasks.tasks_id]').addClass('label label-success');
                                                                        $(document).ready(function(){
                                                                          $(".ap_[tasks.tasks_id]").show(); 
                                                                        });
                                                                      }else if (status == 3){
                                                                      $('#[tasks.tasks_id]').text('Pending Admin Approval'); 
                                                                          $('#[tasks.tasks_id]').addClass('label label-warning');
                                                                        $(document).ready(function(){
                                                                          $(".ad_[tasks.tasks_id]").show(); 
                                                                        });
                                                                      }

                                                                      if(status == 5){ $('#[tasks.tasks_id]').text('Not Assigned'); }
                                                                      </script></span>
                                                                </td>

                                                                <td>
                                                                    <div class="form_[tasks.tasks_id]">
                                                                        <form action="" method="POST" class="form_[tasks.tasks_id]">
                                                                            <input type="hidden" value="[tasks.tasks_id]" name="taskid" />
                                                                            <input type="radio" name="signoff" class="signoff_approved_[tasks.tasks_id]" value="0" checked="checked"> Approved
                                                                            <br>
                                                                            <input type="radio" name="signoff" class="signoff_unapproved_[tasks.tasks_id]" value="1"> Not approved
                                                                            <input type="hidden" name="memo" value="" class="memo_[tasks.tasks_id]" />
                                                                            <input class="btn btn-default" style="float:right;" type="button" value="Submit" onClick="if ($('input[name=signoff][value=1]:checked').length == 1){ var memo = prompt('Please enter a reason for not approving this task.'); $('.memo_[tasks.tasks_id]').val(memo); $('.form_[tasks.tasks_id]').submit(); }else{ $('.form_[tasks.tasks_id]').submit(); }">

                                                                        </form>
                                                                    </div>
                                                                    <div class="na_[tasks.tasks_id]">N/A</div>
                                                                    <div class="ap_[tasks.tasks_id]">Approved by Client</div>
                                                                    <div class="ad_[tasks.tasks_id]">Pending Approval by Admin</div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                        </table>
                                                    </div>
                                                    <div class="widget-foot">
                                                        <!--WI_PAGINATION-->
                                                        <ul class="pagination pull-right">
                                                          [vars.pagination;noerr;htmlconv=no]
                                                        </ul>
                                                        <!--WI_PAGINATION-->
                                                        <div class="clearfix"></div>
                                                        <div id="foot-total">
                                                            Total Cost: $[vars.totals.completed_total]
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>

                                        </div>

                                    </div>

                                    <!--WI_MILESTONES_TABLE-->

                                    <!--WI_TABS_NOTIFICATIONS-->
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <!--[onshow;block=div;when [visible.wi_tabs_notification] == 1;comm]-->
                                            <div class="widget-tabs-notification"> [vars.notification;noerr] </div>
                                        </div>

                                    </div>

                                    <!--WI_TABS_NOTIFICATIONS-->

                                    <!---------------------------------------WI_INFORMATION_AND_TIPS------------------------------------->

                                    <div class="just-a-wrapper" style="margin-top:15px;">
                                        <!--[onshow;block=div;when [vars.milestone_info_no_milestones_found] == 1;comm]-->
                                        <div class="alert alert-info">
                                            <!--[onshow;block=div;when [settings_general.show_information_tips] == 'yes';comm]-->
                                            <a title="[lang.lang_info_information_and_tips]" data-container="body" data-toggle="popover" data-placement="top" data-content="[lang.lang_info_disable_info]"> <i class="icon-info-sign"></i> </a>      
                                            <!--info start-->

                                            [lang.lang_info_milestones;noerr]

                                            <!--info end-->

                                        </div>
                                        <div> <img class="img-responsive" src="[conf.site_url_themes_common;noerr]/images/milestones-and-tasks.png"> </div>
                                    </div>
                                    <!---------------------------------------WI_INFORMATION_AND_TIPS------------------------------------->
                                </div>

                                <div class="clearfix"></div>
                                <!-----------------------------------------------TABS-MILESTONES------------------------------------------------------------------>
                            </div>
                        </div>
                    </div>
                </div>

                <!--WI_NOTIFICATION-->

                <div class="row">
                    <!--[onshow;block=div;when [visible.wi_notification] == 1;comm]-->
                    <div class="col-md-12">
                        <div class="widget">
                            <div class="widget-content widget-big-box">[vars.notification;noerr]</div>
                        </div>
                    </div>

                </div>

                <!--WI_NOTIFICATION-->
            </div>
        </div>
    </div>
    <div class="clearfix"></div>
</div>

<!----------------------COMMON FOOTER--------------------------------->
<!--[onload;file=../common/common.footer.html;getbody;comm]-->
<!----------------------COMMON FOOTER--------------------------------->

<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="icon-chevron-up"></i></a></span>

<!----------------------COMMON PROJECT FOOTER--------------------------------->
<!--[onload;file=common.project.footer.html;getbody;comm]-->
<!----------------------COMMON PROJECT FOOTER--------------------------------->

<!--------------------COMMON FOOTER JAVASCRIPT---------------------------->
<!--[onload;file=../common/common.footer.javascript.html;getbody;comm]-->
<!--------------------COMMON FOOTER JAVASCRIPT---------------------------->

<div id="addNewTaskModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form class="form-horizontal" action="[conf.site_url]/client/tasks/[vars.project_id;noerr]/add" method="post" id="addNewTask" autocomplete="off">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                    <!--full screen icon - custom.js-->
                    <button type="button" class="full-screen-modal close" aria-hidden="true"><i class="icon-fullscreen"></i></button>
                    <!--full screen icon - custom.js-->
                    <h4 class="modal-title"> [lang.lang_add_new_task]</h4>
                </div>
                <div class="modal-body">
                    <div id="task">
                        <script type="text/javascript">
                            $.ajax({
                                url: "[conf.site_url]/__freshbooksapi/_tasks.php"
                            }).done(function(data) {
                                $("#tasks-tasks-list-edit").append(data);
                            });

                            function loadMilestones() {
                                $.ajax({
                                    url: "[conf.site_url]/__freshbooksapi/_milestones.php?projectid=[vars.project_id;noerr]"
                                }).done(function(data) {
                                    $("#tasks-milestones-list").append(data);
                                });
                                $("#tasks-milestones-list").empty();
                            }

                            function loadTeam() {
                                $.ajax({
                                    url: "[conf.site_url]/__freshbooksapi/_teammembers.php?projectid=[vars.project_id;noerr]"
                                }).done(function(data) {
                                    $("#tasks-assigned-to-list").append(data);
                                });
                            }

                            //$(document).ready(function(){
                            loadMilestones();
                            loadTeam();
                            //});

                            var hidden = false;

                            function showMilestone() {
                                if (hidden) {
                                    $("#task").show();
                                    $("#milestone").hide();
                                    hidden = false;
                                } else {
                                    $("#task").hide();
                                    $("#milestone").show();
                                    hidden = true;
                                }
                            }
                        </script>
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group" style="margin-bottom:10px;">
                                    <label class="control-label col-lg-12" style="width:300px;"> Associate task with Milestone:</label>
                                    <div class="col-lg-12">
                                        <select id="tasks-milestones-list" name="tasks_milestones_id" style="width:100%"></select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <br/>
                                <a onClick="showMilestone();" class="btn btn-primary">Add new Milestone</a>
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:10px;">
                            <label class="control-label col-lg-12" style="width:150px;"> Describe the task</label>
                            <div class="col-lg-12">
                                <textarea required class="form-control" id="tasks_text" name="tasks_text"></textarea>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4" style="margin-left:20px;">
                                <div class="row">
                                    <div class="form-group" style="margin-bottom:10px;">
                                        <label class="control-label col-lg-12" style="width:150px;"> [lang.lang_start_date]</label>
                                        <div class="col-lg-12">
                                            <input required type="text" class="form-control pickadate" name="tasks_start_date" id="tasks_start_date">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group" style="margin-bottom:10px;">
                                        <label class="control-label col-lg-12" style="width:300px;"> Hours needed to complete task</label>
                                        <div class="col-lg-12">
                                            <input required type="text" class="form-control" placeholder="In hours (E.g .5 for 30minutes)" id="estimatedtaskhours" name="estimatedtaskhours" autocomplete="off">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="milestone" style="display:none;">
                        <div class="form-group" style="margin-bottom:10px;">
                            <h3 class="control-label col-lg-12" style="width:300px;">Add a new milestone</h3>
                            <div class="col-lg-12">
                                <script type="text/javascript">
                                    function createMilestone() {
                                        $.post("[conf.site_url]/__freshbooksapi/_createmilestone.php", {
                                            milestones_title: $("#milestoneText").val(),
                                            milestones_project_id: $("#milestones_project_id").val(),
                                            milestones_client_id: $("#milestones_client_id").val(),
                                            milestones_created_by: $("#milestones_created_by").val(),
                                            milestones_events_id: $("#milestones_events_id").val(),
                                        }, function(data) {
                                            console.log(data);
                                            loadMilestones();
                                            /*Refresh milestones*/
                                            showMilestone();
                                            alert('Milestone has been created.')
                                        });
                                    }
                                </script>
                                <div class="row">
                                    <div class="col-md-12">
                                        Milestone Name:
                                        <textarea name="milestoneText" id="milestoneText"></textarea>
                                    </div>
                                </div>
                                <br/>
                                <input type="hidden" name="milestones_project_id" id="milestones_project_id" value="[vars.project_id;noerr]">
                                <input type="hidden" name="milestones_client_id" id="milestones_client_id" value="[vars.client_id;noerr]">
                                <input type="hidden" name="milestones_created_by" id="milestones_created_by" value="[vars.my_id;noerr]">
                                <input type="hidden" name="milestones_events_id" id="milestones_events_id" value="[vars.new_events_id;noerr]">
                                <div class="row">
                                    <div class="col-md-6">
                                        <a class="btn btn-warning" onClick="showMilestone();" id="saveMilestoneBtn" style="width:100%;">Return</a>
                                    </div>
                                    <div class="col-md-6">
                                        <a class="btn btn-success" onClick="createMilestone();" id="saveMilestoneBtn" style="width:100%;">Create Milestone</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">[lang.lang_close]</button>
                    <input type="hidden" name="tasks_project_id" value="[vars.project_id;noerr]">
                    <input type="hidden" name="tasks_client_id" value="[vars.client_id;noerr]">
                    <input type="hidden" name="tasks_events_id" value="[vars.new_events_id;noerr]">
                    <input type="hidden" name="tasks_created_by_id" value="[vars.my_id;noerr]">
                    <input type="hidden" id="redirect_url" name="redirect_url" value="[vars.current_url]">
                    <input class="btn btn-primary" type="submit" value="[lang.lang_create_new_task]" name="submit">
                </div>
            </div>
        </form>
    </div>
</div>
    
<script type="text/javascript">
$().ready(function() {
    //USED BY: WI_ADD_NEW_TASK_MODAL
    //ACTIONS: validates the form and submits it
    //REQUIRES: jquery.validate.js
    $("#addNewTask").validate({
        rules: {
            tasks_text: "required",
            tasks_milestones_id: "required",
            tasks_start_date: "required",
            estimatedtaskhours: {
                required: true,
                number: true
            }
        },
        messages: {
            tasks_text: "[lang.lang_field_is_required]",
            tasks_milestones_id: "[lang.lang_field_is_required]",
            tasks_start_date: "[lang.lang_field_is_required]",
        },
        submitHandler: function(form) {
            //alert('form submitted');
            form.submit();
        }
    });
});
</script>
<!--JS_ADD_NEW_TASK_MODAL-->
<!--JS_ADD_NEW_TASK_MODAL-->
<script>
//USED BY: ADD_NEW_TASK_MODAL
//ACTIONS: creates a noce pull down/select for each specified field
//REQUIRES: select2.js
//NOTES: no need for '$().ready(function()' as this only need jquery & select2.js which are loaded up top
$("#tasks-milestones-list").select2({
    allowClear: true
});
$("#tasks-assigned-to-list").select2({
    allowClear: true
});
</script>

</body>

</html>